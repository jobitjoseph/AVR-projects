#define F_CPU 20000000UL
#include <avr/io.h>
#include <avr/pgmspace.h>
#include <avr/interrupt.h>
#include <util/delay.h>

void ccp_write(volatile register8_t* reg, uint8_t value){
	CCP = CCP_IOREG_gc;
	*reg = value;
}

void setup_clock_20mhz_internal(){
	// 20 MHz internal clock, enable CKOUT
	ccp_write(&CLKCTRL.MCLKCTRLA, CLKCTRL.MCLKCTRLA | CLKCTRL_CLKOUT_bm);
	
	// disable prescaler
	ccp_write(&CLKCTRL.MCLKCTRLB, 0);
}

/* Controls output level of pin 3 */
void setup_TCB_PWM(){
	// Enable this peripheral
	TCB0.CTRLA |= TCB_ENABLE_bm;
	
	// Make waveform output available on the pin
	TCB0.CTRLB |= TCB_CCMPEN_bm;
	
	// Enable 8-bit PWM mode
	TCB0.CTRLB |= TCB_CNTMODE_PWM8_gc;
	
	// Set period and duty
	TCB0.CCMPL = 255; // top value
	TCB0.CCMPH = 50; // flip value
}

/* Controls when waveform advances */
void setup_TCA_Advance(){
	// enable this peripheral
	TCA0.SINGLE.CTRLA |= TCA_SINGLE_ENABLE_bm;

	// Overflow triggers interrupt
	TCA0.SINGLE.INTCTRL |= TCA_SINGLE_OVF_bm;

	// Set period and duty
	TCA0.SINGLE.PER = 2500; // 8 kHz at 20 mHz clock
}

// https://skinnysatan.com/2014/01/30/adding-speech-to-your-embedded-project/
const unsigned char seven_samples[] PROGMEM =
{
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,127,128,128,128,128,128,128,128,128,128,128,128,
	128,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,127,128,129,128,128,128,128,128,128,127,128,128,128,128,128,129,127,128,129,128,129,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,128,127,128,128,128,128,128,128,128,128,128,127,128,128,127,128,128,128,128,127,128,128,128,128,
	128,128,128,128,128,129,128,128,128,128,128,128,128,128,128,128,129,128,128,128,127,128,128,128,128,128,128,129,128,128,128,128,128,128,128,127,128,128,128,128,127,128,128,128,128,128,128,129,128,128,128,128,129,128,128,128,127,128,127,127,129,128,128,128,128,128,127,128,128,128,128,128,129,129,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,127,129,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,129,127,129,128,127,128,128,128,128,128,128,128,128,128,128,128,127,127,128,128,129,128,128,128,127,128,128,129,128,128,128,128,128,127,129,128,128,129,127,128,128,128,128,128,128,128,128,
	128,129,128,128,128,128,129,127,128,128,126,128,128,128,128,128,128,128,128,128,129,127,128,128,129,127,127,128,127,129,128,128,128,127,128,128,128,129,128,128,128,128,128,128,128,128,127,129,128,128,128,128,129,127,129,128,129,127,128,128,127,129,128,128,127,128,128,128,128,128,129,128,129,128,128,128,126,129,127,128,128,127,129,128,129,128,128,128,127,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,129,128,128,129,126,128,129,127,127,128,127,129,128,128,129,128,129,127,127,129,127,128,128,127,128,128,128,128,129,129,128,127,127,126,129,128,127,129,127,128,129,128,128,129,128,129,127,128,129,127,128,127,128,128,128,128,128,128,128,128,129,128,127,129,128,128,127,128,129,128,127,128,128,127,127,127,129,127,128,129,128,128,129,128,128,127,128,129,127,128,128,128,128,127,128,129,
	127,129,127,128,129,127,128,128,126,127,129,127,130,127,127,129,128,128,128,128,128,128,128,129,127,129,128,128,129,127,128,128,128,128,128,127,129,128,126,128,128,129,129,128,128,128,127,128,129,127,129,127,127,128,127,129,129,127,129,128,128,128,127,129,128,127,129,127,128,128,128,129,127,127,129,127,129,129,127,129,127,128,129,128,129,128,127,128,127,127,129,127,128,128,127,128,127,128,128,127,
	128,128,128,129,127,128,128,127,129,128,129,128,127,128,128,128,128,127,128,128,127,130,128,129,128,127,128,127,128,128,128,128,128,128,129,127,128,129,128,129,127,128,127,127,129,127,128,128,129,128,128,128,128,128,128,127,128,128,128,128,128,128,128,128,128,128,128,127,128,127,129,129,127,129,128,128,130,128,128,128,128,129,127,127,128,128,128,127,129,128,126,129,129,128,129,128,127,127,128,129,
	128,128,128,129,127,128,129,127,128,129,128,128,128,127,129,128,128,128,128,129,128,127,130,127,128,129,127,130,127,128,129,126,129,128,127,130,127,128,129,127,129,128,128,128,127,129,128,127,128,128,129,128,127,128,127,128,129,128,128,127,127,129,126,128,129,128,128,127,130,129,127,130,129,127,127,128,129,128,127,129,128,128,128,128,129,129,128,128,128,128,127,128,129,127,127,129,129,127,128,129,
	128,127,127,128,129,128,128,129,128,127,127,128,128,127,128,128,128,128,128,128,128,128,128,128,129,128,128,129,127,128,128,128,129,127,129,129,128,129,128,129,128,127,129,128,128,128,127,128,128,128,128,128,129,128,127,129,128,128,128,128,129,127,128,129,128,128,128,128,128,128,128,128,128,128,128,128,128,129,128,128,128,128,128,128,128,128,127,128,128,128,128,127,128,128,127,129,128,128,129,128,
	128,128,128,128,128,129,129,128,129,129,128,129,128,128,129,128,127,128,128,127,128,128,127,127,127,127,126,126,126,126,126,126,126,127,127,128,129,129,130,131,132,132,132,133,133,133,133,133,133,132,132,133,132,131,130,130,129,127,127,125,124,122,121,121,118,117,117,115,113,107,104,101,100,108,117,126,138,149,160,164,163,163,159,154,148,144,143,138,136,137,137,135,132,131,130,126,122,117,110,99,
	84,73,59,50,76,104,115,135,161,182,180,167,168,159,136,115,105,106,96,93,111,126,139,150,166,183,178,172,167,156,142,127,124,122,115,118,122,126,127,123,124,113,96,81,62,49,51,93,120,125,158,184,191,174,156,158,136,105,94,93,99,92,101,135,146,158,172,185,189,167,160,153,133,123,118,125,127,124,135,139,135,129,123,117,91,73,58,43,34,62,130,145,158,196,208,194,151,134,129,89,
	71,75,94,110,110,148,177,173,178,175,173,153,129,135,127,121,129,138,151,145,146,152,139,129,117,110,99,72,64,51,42,43,79,160,169,175,210,203,174,119,101,101,66,65,89,121,145,145,180,196,167,157,144,133,116,108,134,140,144,161,168,166,148,139,138,120,109,108,106,101,84,78,71,58,53,70,147,174,162,192,193,168,117,90,101,81,76,102,134,160,155,170,185,154,133,124,120,115,114,144,
	162,161,169,171,161,138,125,126,117,111,116,121,117,106,96,85,65,52,46,69,156,176,169,199,191,162,104,81,95,76,82,113,147,173,161,173,180,139,121,112,113,117,122,159,173,169,173,165,151,126,116,120,115,116,122,128,122,108,94,80,57,47,44,73,167,186,176,203,187,152,90,70,89,76,88,125,162,185,166,171,170,124,105,101,110,121,134,173,185,175,171,158,139,115,109,121,120,124,132,137,
	129,113,97,79,63,47,46,51,126,202,183,192,196,164,112,58,74,87,83,116,154,189,183,158,168,137,97,95,103,124,136,162,193,183,169,158,140,121,105,116,128,125,134,140,135,120,105,92,70,57,53,49,63,151,206,182,188,184,151,93,55,82,93,95,128,168,193,172,152,158,122,93,97,112,136,148,174,193,176,160,146,130,115,107,123,134,133,138,139,131,113,97,83,73,58,48,53,77,167,201,
	178,192,175,138,84,58,88,93,103,141,171,190,165,149,151,112,95,102,117,144,154,179,189,168,156,139,125,115,112,129,135,135,139,134,126,111,96,84,74,64,59,59,75,151,197,178,180,172,145,96,64,88,100,106,133,162,185,166,146,150,123,102,104,119,146,153,169,182,169,155,139,130,124,116,127,135,136,136,131,126,115,97,86,80,70,58,65,73,123,182,178,178,173,150,117,77,83,98,102,126,
	148,174,174,151,152,136,114,110,115,140,150,156,173,169,159,144,134,132,121,123,131,132,130,124,124,116,99,88,86,76,64,66,75,118,169,173,175,173,153,124,89,88,99,103,122,142,164,169,153,153,142,122,116,120,139,146,151,165,167,158,146,138,136,126,122,128,129,126,124,121,116,102,87,85,79,65,69,76,116,166,168,171,171,155,129,93,92,104,104,119,136,158,167,151,153,147,129,124,125,139,
	145,144,158,162,155,147,141,140,132,123,127,126,121,118,115,111,98,88,89,80,72,73,82,127,159,159,168,165,153,128,101,103,107,108,120,133,155,158,149,154,146,136,133,132,142,141,142,153,154,151,146,141,141,132,124,124,123,119,114,111,106,99,90,84,82,78,77,97,136,155,157,161,159,149,126,107,108,113,113,119,133,149,152,148,150,147,144,139,137,141,141,141,144,146,146,143,140,139,133,127,
	124,122,121,116,111,108,101,96,90,86,87,86,101,130,143,147,150,150,148,134,120,118,120,122,123,128,138,142,141,141,140,141,140,138,138,140,141,141,139,138,138,135,133,131,130,130,128,126,125,123,121,118,114,112,110,108,106,103,101,106,117,126,131,133,135,138,136,132,129,128,129,131,131,131,133,134,135,135,135,136,136,137,136,136,136,136,136,135,133,132,131,130,130,129,129,128,128,128,126,124,
	123,122,120,118,117,115,112,110,110,114,119,123,125,126,129,132,132,131,131,131,132,133,132,132,132,132,133,134,135,134,134,133,133,134,134,133,133,133,132,131,130,130,130,129,129,129,129,128,128,127,126,126,125,124,123,122,121,119,118,117,116,117,120,121,122,123,125,127,128,129,130,130,131,132,132,132,132,132,132,133,133,132,132,132,132,132,131,131,131,131,131,130,130,130,129,130,129,129,129,129,
	128,128,128,127,127,127,126,125,125,125,124,124,123,123,123,122,123,124,124,125,125,126,127,127,128,128,129,130,130,130,131,131,131,131,131,131,131,131,131,131,131,130,130,130,130,129,129,129,129,128,128,128,128,128,128,128,127,127,127,127,127,127,127,127,126,126,126,126,126,126,126,126,125,126,126,126,126,126,127,127,127,128,128,129,129,130,130,130,131,131,131,131,131,131,131,131,131,130,130,130,
	129,129,129,128,128,128,127,127,128,127,127,127,127,127,126,127,127,127,126,126,127,126,126,126,126,127,126,126,127,126,126,126,126,127,127,127,128,128,129,129,130,130,130,131,131,131,131,131,131,131,131,131,130,130,130,129,129,129,128,129,128,127,127,127,127,127,126,127,126,127,126,127,127,126,126,126,125,126,125,125,126,125,125,125,126,126,126,127,127,128,128,129,130,130,131,131,131,132,132,132,
	132,132,132,132,131,131,131,130,130,129,129,129,129,128,127,127,127,126,126,126,126,126,125,125,125,124,124,124,124,123,123,123,123,123,123,124,125,126,127,128,129,130,131,131,132,133,133,134,134,134,134,134,133,134,133,133,133,133,132,131,131,130,129,129,128,128,127,126,126,126,125,124,124,123,121,120,119,119,118,117,117,117,119,122,124,127,130,131,132,132,132,132,131,132,132,132,132,132,133,133,
	133,133,134,134,135,135,135,134,134,134,133,133,133,132,131,130,129,129,128,126,125,125,123,121,118,115,114,113,111,109,110,113,119,124,129,133,135,136,135,132,131,129,127,126,127,129,130,131,133,134,135,135,135,135,135,135,134,135,135,135,134,134,135,135,134,133,133,132,130,129,128,126,124,122,121,118,113,111,108,108,105,104,109,119,127,131,135,140,141,137,132,129,128,124,122,125,128,130,131,134,
	137,137,136,135,135,135,133,132,134,135,136,136,136,136,135,135,135,134,133,130,129,128,126,124,121,120,118,113,110,108,105,104,102,107,118,127,133,137,142,143,137,132,129,126,123,120,124,127,130,132,135,138,138,135,135,133,133,130,131,134,136,137,138,139,139,137,137,136,135,133,131,130,129,127,126,124,121,119,115,110,106,104,102,101,101,110,123,130,135,139,142,138,130,127,126,124,123,126,134,136,
	138,139,139,137,132,129,128,127,128,129,133,136,137,138,139,138,135,134,135,134,134,134,135,134,131,130,128,126,122,118,115,110,106,103,101,101,101,107,121,129,135,138,140,138,130,126,124,124,125,128,136,139,141,141,138,136,130,127,126,126,128,129,134,136,138,138,137,137,134,133,133,134,135,135,137,136,134,132,129,126,122,120,117,111,106,104,102,101,100,105,118,128,132,136,139,138,130,126,126,126,
	126,129,136,140,140,140,138,135,129,125,125,125,127,129,133,136,136,137,136,136,134,133,134,135,136,137,138,138,136,134,132,129,125,122,121,117,112,108,106,102,100,102,105,114,124,132,136,136,137,133,128,126,126,129,130,135,139,140,139,136,134,130,126,125,125,127,128,131,134,135,136,135,135,133,133,135,135,136,137,139,139,138,136,133,130,126,125,122,119,116,114,111,105,101,102,103,105,113,125,131,
	134,135,137,134,129,127,129,130,130,134,139,139,137,135,134,130,126,125,126,126,127,130,133,134,134,134,135,134,133,135,136,136,137,139,139,137,136,134,131,128,126,123,120,118,116,113,107,105,105,105,104,108,118,125,129,133,136,136,132,130,131,130,130,132,135,137,136,136,135,133,129,127,127,127,128,129,131,133,133,134,135,134,134,135,136,136,137,137,138,137,135,134,132,130,127,125,123,120,118,114,
	110,106,104,104,104,107,113,121,127,131,134,136,134,132,131,131,131,132,134,136,137,136,135,134,131,128,127,127,127,128,129,131,132,132,133,134,134,134,135,136,136,137,137,137,136,135,133,131,129,127,125,122,120,118,115,112,109,107,105,106,108,111,117,123,128,131,133,135,134,133,133,133,133,133,134,135,135,134,133,132,130,129,129,128,129,129,130,130,131,131,132,133,134,135,135,136,137,137,136,136,
	135,133,131,130,128,126,124,122,121,118,115,113,111,109,108,109,110,113,117,121,125,128,131,133,134,135,135,136,135,135,135,134,134,133,132,131,130,130,130,130,130,129,130,129,129,130,130,131,132,133,134,135,136,136,136,136,136,135,134,133,131,129,128,125,124,122,119,117,115,113,111,110,109,109,110,111,113,115,118,122,125,129,132,136,138,140,142,143,143,142,141,140,139,137,135,133,132,131,129,128,
	128,127,127,127,128,129,129,130,131,132,133,134,134,134,134,133,132,131,129,127,125,122,118,115,112,109,107,106,106,107,108,111,114,119,123,127,131,136,139,142,143,145,145,144,143,141,140,137,135,134,132,130,129,127,126,126,125,126,126,127,128,129,130,132,133,134,135,135,136,135,135,134,132,130,127,125,122,118,116,113,110,108,107,106,107,108,110,114,118,122,126,130,134,137,140,142,144,145,144,144,
	142,141,139,137,135,133,131,129,128,127,126,126,125,126,126,127,128,129,131,132,133,134,135,135,135,134,133,132,130,128,125,123,120,117,114,112,110,109,108,108,109,111,114,117,120,124,128,132,135,138,140,142,143,143,143,142,141,139,138,136,134,132,131,129,128,127,127,126,126,126,127,128,129,130,131,132,133,133,134,134,133,132,131,130,128,126,124,121,118,116,114,112,110,110,109,110,112,113,116,119,
	123,126,130,133,136,139,140,142,142,142,142,141,140,138,137,135,133,132,130,129,128,127,127,127,127,127,128,129,129,130,131,132,133,133,133,133,132,131,130,129,127,125,123,120,118,116,114,113,112,111,111,112,113,115,118,121,124,127,130,133,136,138,139,140,141,142,141,140,139,138,137,135,134,132,131,130,129,128,128,127,127,127,128,129,129,130,131,131,131,131,131,131,130,129,128,127,126,124,122,120,
	118,116,115,114,113,113,113,114,115,117,119,122,125,128,131,133,136,138,139,140,140,141,140,139,138,137,136,135,133,132,131,130,129,129,128,128,128,128,128,129,129,130,130,130,130,130,130,130,129,128,127,126,124,123,121,119,118,116,115,115,114,114,115,116,117,119,121,124,126,129,131,134,136,137,138,139,140,140,139,139,138,137,136,135,134,133,132,131,130,129,129,128,128,128,128,128,128,129,129,129,
	129,129,128,128,127,127,125,124,123,122,121,119,118,117,117,116,116,116,117,118,119,121,123,125,128,130,132,134,136,137,139,140,140,140,140,139,139,138,136,135,134,133,131,130,129,128,128,127,127,126,126,126,126,126,126,126,126,126,126,126,125,125,124,123,122,122,121,120,119,119,119,118,119,119,120,122,123,125,127,129,131,133,134,136,137,138,138,139,139,139,138,137,136,135,134,133,132,131,130,129,
	128,127,127,126,126,126,126,126,126,126,126,126,126,126,125,125,125,124,123,123,123,122,121,121,120,120,120,121,121,122,123,125,126,128,129,131,132,133,134,135,136,137,137,137,137,136,136,135,134,134,133,132,131,130,129,128,128,127,127,127,126,126,126,126,126,126,126,126,125,125,125,125,124,124,123,123,122,122,122,122,122,122,122,123,123,124,125,126,127,128,129,131,132,133,133,134,135,135,135,135,
	135,135,134,134,133,133,132,131,131,130,129,129,128,128,127,127,127,127,126,126,126,126,126,126,125,125,125,125,125,124,124,124,124,123,123,123,123,123,123,124,124,125,126,126,127,128,129,130,131,132,132,133,133,134,134,134,134,134,134,133,133,132,132,131,131,130,129,129,129,128,128,127,127,127,126,126,126,126,126,125,125,125,125,125,125,125,125,125,124,124,125,125,124,124,125,125,125,126,126,127,
	127,128,128,129,130,130,131,131,132,132,132,132,133,133,132,132,132,132,132,131,131,130,130,130,129,129,128,128,127,127,127,127,126,126,126,125,125,125,125,125,125,125,125,125,125,126,126,125,126,126,126,126,126,126,127,127,127,128,128,128,129,129,130,130,130,130,131,131,131,131,131,131,131,131,131,131,131,130,130,130,129,129,129,128,128,128,127,127,127,126,126,126,126,126,126,126,126,126,126,126,
	126,127,127,127,127,127,127,127,127,127,127,127,127,127,127,128,128,128,128,129,129,129,129,130,130,130,130,130,130,131,130,130,130,130,130,129,129,129,129,128,128,128,127,127,127,127,127,127,126,126,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,127,127,127,127,127,127,127,127,127,127,127,128,128,128,129,129,129,129,129,129,130,130,130,130,129,129,129,129,129,128,128,128,128,128,
	128,128,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,127,128,127,127,127,127,127,127,127,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,127,127,127,127,127,127,127,127,128,128,128,128,
	128,128,128,128,128,128,128,128,129,129,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
	128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,128,
};

const long seven_length = sizeof(seven_samples);

volatile int AUDIO_INDEX = 0;

ISR(TCA0_OVF_vect)
{
	TCB0.CCMPH = pgm_read_byte(&seven_samples[AUDIO_INDEX++]);
	
	if (AUDIO_INDEX >= seven_length)
	AUDIO_INDEX = 0;
	
	TCA0.SINGLE.INTFLAGS = TCA_SINGLE_OVF_bm; // indicate interrupt was handled
}

int main(void)
{
	PORTA.DIR = 0xFF;
	PORTB.DIR = 0xFF;
	
	setup_clock_20mhz_internal();
	setup_TCB_PWM();
	setup_TCA_Advance();
	sei();
	
	while (1)
	{
		_delay_ms(500);
		PORTA.OUT = 255;
		_delay_ms(500);
		PORTA.OUT = 0;
	}
}